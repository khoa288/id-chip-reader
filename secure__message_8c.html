<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ID Chip Reader: src/access/secure_message.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ID Chip Reader
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('secure__message_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">secure_message.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Secure messaging implementation for communication with a smart card.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;<a class="el" href="des_8h_source.html">cryptography/des.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="mac3_8h_source.html">cryptography/mac3.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="reader_8h_source.html">utils/reader.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="util_8h_source.html">utils/util.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa54eb97588255069b15e75ede98b2e64"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__message_8c.html#aa54eb97588255069b15e75ede98b2e64">IncreaseUnsignedCharByOne</a> (unsigned char *hexArray, int len)</td></tr>
<tr class="separator:aa54eb97588255069b15e75ede98b2e64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a553597767ffd4a0c50196810f91d668c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__message_8c.html#a553597767ffd4a0c50196810f91d668c">ProtectedSelectAPDU</a> (unsigned char cmdData[2], unsigned char *sendSequenceCounter, unsigned char encryptSessionKey[16], unsigned char macSessionKey[16])</td></tr>
<tr class="memdesc:a553597767ffd4a0c50196810f91d668c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a protected SELECT APDU command to the smart card.  <a href="secure__message_8c.html#a553597767ffd4a0c50196810f91d668c">More...</a><br /></td></tr>
<tr class="separator:a553597767ffd4a0c50196810f91d668c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc0fc15802d5f9a0e45af5e48df20bf2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__message_8c.html#afc0fc15802d5f9a0e45af5e48df20bf2">ProtectedReadBinaryAPDU</a> (unsigned char cmdHeader[4], unsigned char resLen, unsigned char *responseBuf, unsigned char *sendSequenceCounter, unsigned char encryptSessionKey[16], unsigned char macSessionKey[16])</td></tr>
<tr class="memdesc:afc0fc15802d5f9a0e45af5e48df20bf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a protected READ BINARY APDU command to the smart card.  <a href="secure__message_8c.html#afc0fc15802d5f9a0e45af5e48df20bf2">More...</a><br /></td></tr>
<tr class="separator:afc0fc15802d5f9a0e45af5e48df20bf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Secure messaging implementation for communication with a smart card. </p>
<dl class="section author"><dt>Author</dt><dd>Khoa Nguyen</dd></dl>
<p>This file provides the implementation for secure messaging between an application and a smart card. It implements protected APDU commands for SELECT and READ BINARY operations, using encryption and MAC calculation and integrity of the communication. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aa54eb97588255069b15e75ede98b2e64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa54eb97588255069b15e75ede98b2e64">&#9670;&nbsp;</a></span>IncreaseUnsignedCharByOne()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void IncreaseUnsignedCharByOne </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>hexArray</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="afc0fc15802d5f9a0e45af5e48df20bf2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc0fc15802d5f9a0e45af5e48df20bf2">&#9670;&nbsp;</a></span>ProtectedReadBinaryAPDU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ProtectedReadBinaryAPDU </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>cmdHeader</em>[4], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>resLen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>responseBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>sendSequenceCounter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>encryptSessionKey</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>macSessionKey</em>[16]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a protected READ BINARY APDU command to the smart card. </p>
<p>This function sends a protected READ BINARY APDU command to the smart card using encryption and MAC calculation to ensure confidentiality and integrity of the communication. The response data will be decrypted and stored in the provided buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmdHeader</td><td>Pointer to a 4-byte array representing the command header for the READ BINARY operation. </td></tr>
    <tr><td class="paramname">resLen</td><td>Length of expected response data in bytes. </td></tr>
    <tr><td class="paramname">responseBuf</td><td>Pointer to a buffer where the decrypted response data will be stored. </td></tr>
    <tr><td class="paramname">sendSequenceCounter</td><td>Pointer to an 8-byte array representing the current Send Sequence Counter (SSC). </td></tr>
    <tr><td class="paramname">encryptSessionKey</td><td>Pointer to a 16-byte array containing the encryption session key (KS_Enc). </td></tr>
    <tr><td class="paramname">macSessionKey</td><td>Pointer to a 16-byte array containing the MAC session key (KS_MAC).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>APP_SUCCESS if successful; otherwise, an error code indicating failure reason. </dd></dl>

</div>
</div>
<a id="a553597767ffd4a0c50196810f91d668c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a553597767ffd4a0c50196810f91d668c">&#9670;&nbsp;</a></span>ProtectedSelectAPDU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ProtectedSelectAPDU </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>cmdData</em>[2], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>sendSequenceCounter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>encryptSessionKey</em>[16], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>macSessionKey</em>[16]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a protected SELECT APDU command to the smart card. </p>
<p>This function sends a protected SELECT APDU command to the smart card using encryption and MAC calculation to ensure confidentiality and integrity of the communication.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cmdData</td><td>File identifier (2 bytes) to be selected by this command. </td></tr>
    <tr><td class="paramname">sendSequenceCounter</td><td>Pointer to an 8-byte array representing the current Send Sequence Counter (SSC). </td></tr>
    <tr><td class="paramname">encryptSessionKey</td><td>Pointer to a 16-byte array containing the encryption session key (KS_Enc). </td></tr>
    <tr><td class="paramname">macSessionKey</td><td>Pointer to a 16-byte array containing the MAC session key (KS_MAC).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>APP_SUCCESS if successful; otherwise, an error code indicating failure reason. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a6f14b204945acfc5663c8adfd39e86e.html">access</a></li><li class="navelem"><a class="el" href="secure__message_8c.html">secure_message.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
